@model FirstWebApplication.Models.ObstacleData
@{
    ViewData["Title"] = "Overview";
}
<main class="min-h-screen bg-gray-50">
  <div class="mx-auto max-w-xl px-4 py-10 sm:py-16">
    <h1 class="text-2xl sm:text-3xl font-semibold text-gray-900 mb-6">Obstacle Overview</h1>

    <div class="grid gap-4 bg-white p-6 rounded-xl shadow">
      <p><span class="font-semibold">Name:</span> @Model.ObstacleName</p>
      <p><span class="font-semibold">Height:</span> @Model.ObstacleHeight</p>
      <p><span class="font-semibold">Description:</span> @Model.ObstacleDescription</p>
    </div>

    <!-- Kart som viser GeoJSON -->
    <div class="mt-6">
      <label class="block text-sm font-medium text-gray-700 mb-2">Obstacle location</label>
      <div id="map-overview" class="rounded-xl border border-gray-200" style="height:420px;"></div>
    </div>

    <div class="mt-6 flex gap-3">
      <a asp-controller="Obstacle" asp-action="DataForm" class="inline-flex items-center justify-center rounded-lg border px-4 py-2 text-gray-700 hover:bg-gray-50">Register another</a>

      <!-- EDIT-knapp: Post hele modellen til Obstacle/Edit -->
      <form asp-controller="Obstacle" asp-action="Edit" method="post" class="contents">
        <input type="hidden" name="ObstacleName" value="@Model.ObstacleName" />
        <input type="hidden" name="ObstacleHeight" value="@Model.ObstacleHeight" />
        <input type="hidden" name="ObstacleDescription" value="@Model.ObstacleDescription" />
        <input type="hidden" name="GeometryGeoJson" value="@Model.GeometryGeoJson" />
        <button type="submit" class="inline-flex items-center justify-center rounded-lg bg-blue-600 px-4 py-2 text-white hover:bg-blue-700">
          Edit
        </button>
      </form>
    </div>
  </div>
</main>

@section Scripts {
  <script>
    const map = L.map('map-overview').setView([58.1467, 7.9956], 12);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 20,
      attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);

    const geoJsonStr = '@(Model.GeometryGeoJson ?? "")'.replace(/&quot;/g, '"');
    if (geoJsonStr) {
      try {
        const gj = JSON.parse(geoJsonStr);
        const layer = L.geoJSON(gj).addTo(map);
        if (layer.getLayers().length > 0) map.fitBounds(layer.getBounds(), { padding: [20,20] });
      } catch (err) {
        console.warn("Kunne ikke lese GeoJSON:", err);
      }
    }
  </script>
}
